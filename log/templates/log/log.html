{% extends "accounts/layout.html" %}

{% block title %}Log{% endblock title %}

{% block link %}
{% load static %}
    <link rel="stylesheet" type="text/css" href="{% static 'log/log_display.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'log/modals.css' %}">
    
{% endblock link %}

{% block style %}<style></style>{% endblock style %}

{% block nav %}
<ul class="left-list">
    <li><a class="a-empty" href="" data-bs-toggle="modal" data-bs-target="#categoriesModal">• Categories </a></li>
    <li><a class="a-empty" style="color:red;" href="/calendar">• Calendar </a></li>
    <li><a class="a-empty" style="color:red;" href="/settings">• Settings </a></li>
    
    <li>
        <a class="a-empty" href="/logout">
            <img class="large_icon_button" src="{% static 'log/icons/exit.png'%}">
            Log out 
        </a>
    </li>
    <li><a class="a-empty" href="https://github.com/RomanchenkoAS">• Github </a></li>
</ul>
{% endblock nav %}

{% block body %}

<header>
    <hr> 
    <h1 class="header center">MainPage || Log of: {{user}}</h1>
    <hr>
    <h2 class="header center">Latest events: </h2>

    <!-- Modal for categories-->
    <div class="modal" id="categoriesModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5">Category editor</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p> Customize categories and <a class="a-empty-blue" onclick="expand_custom()">add new</a> from here: </p>
                    <button class="collapsible small-margin">Default ▼ </button>
                    <div class="content" id="default_categories_container">
                        {% load filters %}
                        {% if categories %}
                        {% for category in categories %}
                        <span>
                            <p id="{{category.name}}-item" data-color="{{category.color}}" style="background-color:{{category.color}}" class="category small-margin">{{category.name}} 
                                <!-- Edit -->
                                <a id="{{category.name}}-edit-button" class="a-none" onclick="expand('{{category.name}}')" >
                                    <img class="icon_button" src="{% static 'log/icons/edit.png'%}">
                                </a>

                                <span class="edit_palette" id="{{category.name}}-edit">
                                    <!-- Colorpicker -->
                                    <input class="color_picker" type="color" id="{{category.name}}-colorpicker">
                                    <!-- Tick -->
                                    <a onclick="edit('{{category.name}}')" class="a-none" title="" aria-label="Submit and save shanges.">
                                        <img class="icon_button" src="{% static 'log/icons/tick.svg'%}">
                                    </a>
                                    <!-- Cross -->
                                    <a onclick='hide("{{category.name}}")' class="a-none" title="" aria-label="Dismiss changes.">
                                        <img class="icon_button" src="{% static 'log/icons/cross.svg'%}">
                                    </a>
                                    <!-- Reset -->
                                    <a onclick="edit('{{category.name}}', 'reset')" class="a-none"  title="" aria-label="Reset to the default color. Reload required.">
                                        <img class="icon_button" src="{% static 'log/icons/reset.svg'%}">
                                    </a>
                                </span>
                                <!-- Info -->
                                <a onclick='' class="a-none" title="" aria-label="{{category.info}}">
                                    <img class="icon_button" src="{% static 'log/icons/info.svg'%}">
                                </a>
                            </p>
                        </span>
                        {% endfor %}
                        {% endif%}
                    </div>
                    <button class="collapsible small-margin" id="collapsible_custom">Custom ▼ </button>

                    <!-- Custom block -->
                    <div class="content" id="custom_categories_container">
                        {% if user_categories %}
                        {% for category in user_categories %}
                        <!-- Existing user categories -->
                        <span>
                            <p id="{{category.name}}-item" data-color="{{category.color}}" style="background-color:{{category.color}}" class="category small-margin">{{category.name}} 
                                <a id="{{category.name}}-edit-button" class="a-none" onclick="expand('{{category.name}}')" >
                                    <img class="icon_button" src="{% static 'log/icons/edit.png'%}">
                                </a>
                                <span class="edit_palette" id="{{category.name}}-edit">
                                    <!-- Input name field -->
                                    <input class="change_name" type="text" id="{{category.name}}-newname" value="{{category.name}}"> 
                                    <!-- Colorpicker -->
                                    <input class="color_picker" type="color" id="{{category.name}}-colorpicker">
                                    <!-- Tick -->
                                    <a onclick="edit('{{category.name}}')" class="a-none" title="" aria-label="Submit and save shanges.">
                                        <img class="icon_button" src="{% static 'log/icons/tick.svg'%}">
                                    </a>
                                    <!-- Cross -->
                                    <a onclick='hide("{{category.name}}")' class="a-none" title="" aria-label="Dismiss changes.">
                                        <img class="icon_button" src="{% static 'log/icons/cross.svg'%}">
                                    </a>
                                    <!-- Delete -->
                                    <a onclick='edit("{{category.name}}", "delete")' class="a-none" title="" aria-label="Delete this category.">
                                        <img class="icon_button" src="{% static 'log/icons/delete.svg'%}">
                                    </a>
                                </span>
                            </p>
                        </span>
                        {% endfor %}
                        {% endif %}
                        <!-- Create new category -->
                        <span >
                            <p id="add-item" style="background-color:#d3d3d3" class="category small-margin">Create new category
                                <!-- Edit -->
                                <a id="add-edit-button" onclick='expand("add")' class="a-none">
                                    <img class="icon_button" src="{% static 'log/icons/plus.svg'%}">
                                </a>

                                <span class="edit_palette" id="add-edit">
                                    <!-- Input name field -->
                                    <input class="change_name" type="text" id="add-newname"> 
                                    <!-- Colorpicker -->
                                    <input class="color_picker" type="color" id="add-colorpicker" value="#d3d3d3">
                                    <!-- Tick -->
                                    <!-- Edit syntax is edit(categoryName, action)-->
                                    <a onclick='edit("add", "add")' class="a-none">
                                        <img class="icon_button" src="{% static 'log/icons/tick.svg'%}">
                                    </a>
                                    <!-- Cross -->
                                    <a onclick='hide("add")' class="a-none">
                                        <img class="icon_button" src="{% static 'log/icons/cross.svg'%}">
                                    </a>
                                </span>
                            </p>
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </div>

</header>

<main>
    <!-- Container for my log table || fills with load_content() function-->
    <div class="center" id="logTableContainer">
            <table id="logTable"><tbody></tbody></table>
    </div>
</main>

<footer>
    <!-- MAIN FEATURE HERE -->
    <div class="center">
        <form id="add-entry">
            <span>
                <!-- Value field -->
                <input required pattern="[0-9]+" name="value" id="input-value" placeholder="Value:" class="form-item">
                <!-- Category field -->
                <select name="category" id="input-category" class="form-selector">
                    {% for category in categories %}
                    {% if forloop.counter == 1 %}
                        <option selected value="{{ category.name }}">{{category.name}}</option>
                        {% else %}
                        <option value="{{ category.name }}">{{category.name}}</option>
                        {% endif %}
                    {% endfor %}
                    <!-- User categories -->
                    {% for category in user_categories %}
                        <option value="{{ category.name }}">{{category.name}}</option>
                    {% endfor %}
                </select>
                <!-- Comment field -->
                <input name="comment" id="input-comment" placeholder="Comment:" class="form-item">
                <!-- Add button -->
                <button class="btn" type="submit">
                    <img class="icon_button" src="{% static 'log/icons/plus.svg'%}">
                </button>
            </span>
        </form>
    </div>
</footer>
{% endblock body %}

{% block script %}
    <script src="{% static 'log/log_management.js' %}"></script>
    {% comment %} Scripts for modal windows management {% endcomment %}
    <script src="{% static 'log/modal_category.js' %}"></script>

    {% endblock script %}
